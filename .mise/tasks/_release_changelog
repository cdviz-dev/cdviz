#!/usr/bin/env bash
#MISE description="[internal] Generate changelog"
#MISE hide=true
#MISE dir="{{cwd}}"
#USAGE arg "<name>" help="Component name"
#USAGE arg "<depends>" help="Path pattern for git-cliff"
#USAGE arg "<version>" help="Version for this release"
set -euo pipefail

NAME="${usage_name:?}"
DEPENDS="${usage_depends:?}"
VERSION="${usage_version:?}"

ROOT=$(git rev-parse --show-toplevel)
git cliff --config "$ROOT/cliff.toml" \
  --include-path "$DEPENDS" \
  --tag-pattern "^($NAME-)?[0-9]+\\.[0-9]+\\.[0-9]+.*$" \
  --tag "$VERSION" \
  -o CHANGELOG.md

echo "Generated CHANGELOG.md for $NAME $VERSION" >&2
